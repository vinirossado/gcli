package repository

import (
	"context"

	"github.com/pkg/errors"

	"{{ .ProjectName }}/source/model"
)

type {{ .StructName }}Repository interface {
	GetAll{{ .StructName }}(ctx context.Context) (*[]model.{{ .StructName }}, error)
	Get{{ .StructName }}ById(ctx context.Context, id uint) (*model.{{ .StructName }}, error)
	Create{{ .StructName }}(ctx context.Context, {{ .StructNameLowerFirst }} *model.{{ .StructName }}) (uint, error)
	Update{{ .StructName }}(ctx context.Context, {{ .StructNameLowerFirst }} *model.{{ .StructName }}) (uint, error)
	Delete{{ .StructName }}(ctx context.Context, id uint) error
}

type {{ .StructNameLowerFirst }}Repository struct {
	*Repository
}

func New{{ .StructName }}Repository(repository *Repository) {{ .StructName }}Repository {
	return &{{ .StructNameLowerFirst }}Repository{
		Repository: repository,
	}
}

func (r *{{ .StructNameLowerFirst }}Repository) GetAll{{ .StructName }}(ctx context.Context) (*[]model.{{ .StructName }}, error) {
	var items []model.{{ .StructName }}
	if err := r.db.WithContext(ctx).Find(&items).Error; err != nil {
		return nil, errors.Wrap(err, "failed to get all {{ .StructNameLowerFirst }}")
	}
	return &items, nil
}

func (r *{{ .StructNameLowerFirst }}Repository) Get{{ .StructName }}ById(ctx context.Context, id uint) (*model.{{ .StructName }}, error) {
	var item model.{{ .StructName }}
	if err := r.db.WithContext(ctx).First(&item, id).Error; err != nil {
		return nil, errors.Wrap(err, "{{ .StructNameLowerFirst }} not found")
	}
	return &item, nil
}

func (r *{{ .StructNameLowerFirst }}Repository) Create{{ .StructName }}(ctx context.Context, {{ .StructNameLowerFirst }} *model.{{ .StructName }}) (uint, error) {
	if err := r.db.WithContext(ctx).Create({{ .StructNameLowerFirst }}).Error; err != nil {
		return 0, errors.Wrap(err, "failed to create {{ .StructNameLowerFirst }}")
	}
	return {{ .StructNameLowerFirst }}.ID, nil
}

func (r *{{ .StructNameLowerFirst }}Repository) Update{{ .StructName }}(ctx context.Context, {{ .StructNameLowerFirst }} *model.{{ .StructName }}) (uint, error) {
	if err := r.db.WithContext(ctx).Save({{ .StructNameLowerFirst }}).Error; err != nil {
		return 0, errors.Wrap(err, "failed to update {{ .StructNameLowerFirst }}")
	}
	return {{ .StructNameLowerFirst }}.ID, nil
}

func (r *{{ .StructNameLowerFirst }}Repository) Delete{{ .StructName }}(ctx context.Context, id uint) error {
	if err := r.db.WithContext(ctx).Delete(&model.{{ .StructName }}{}, id).Error; err != nil {
		return errors.Wrap(err, "failed to delete {{ .StructNameLowerFirst }}")
	}
	return nil
}
